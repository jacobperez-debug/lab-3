---
title: "Science and Trust"
format:
  dashboard:
    orientation: columns
    nav-buttons: [linkedin, github]
    linkedin: www.linkedin.com/in/jacob-u-perez
    github: https://github.com/jacobperez-debug
    theme: flatly
---

```{r}
#|label: libraries

library(tidyverse)
library(ggplot2)
library(readxl)
```

```{r}
#|label: read in data

wgm2018 <- read_excel(here::here("wgm2018-dataset-crosstabs-all-countries.xlsx"), sheet = 2)

wgm2018.3 <- read_excel(here::here("wgm2018-dataset-crosstabs-all-countries.xlsx"), sheet = 3)

wgm2020 <- read.csv(here::here("wgm_full_wave2_public_file_final (1)_csv.csv"))
```

```{r}
df_raw_2018 <- tibble(x = str_split(wgm2018.3$`Variable Type & Codes*`[1], ',\\s')[[1]])

df_countries_2018 <- df_raw_2018 %>%
  separate_wider_delim(x, delim = '=', names = c("country_id", "country_name")) %>%
  mutate(country_id = as.numeric(country_id))

df_wgm2018 <-  left_join(wgm2018, df_countries_2018, by = c("WP5" = "country_id")) %>%
  mutate(region = case_when(
    Regions_Report %in% c(1, 2, 4, 5) ~ "Africa",
    Regions_Report %in% c(6, 7, 8) ~ "Americas",
    Regions_Report %in% c(9, 10, 11, 12, 18) ~ "Asia",
    Regions_Report %in% c(3, 13) ~ "Middle East and North Africa",
    Regions_Report %in% c(14) ~ "Former Soviet Union",
    Regions_Report %in% c(15, 16, 17, 0) ~ "Europe"
  )) %>%
  select(country_name, region, wgt, Q11B, Q11C, Q16)
```

```{r}
df_wgm2020 <- wgm2020 %>%
  mutate(region = case_when(
    Global11Regions %in% c(11) ~ "Middle East and Africa",
    Global11Regions %in% c(9, 10) ~ "Americas",
    Global11Regions %in% c(4, 6, 7, 8, 5) ~ "Asia",
    Global11Regions %in% c(3) ~ "Russia",
    Global11Regions %in% c(1, 2) ~ "Europe"
  )) %>%
  select(COUNTRYNEW, region, WGT, W5B, W5C, W8)
```

# Trust in Science

## Global Trust in Scientists Facts
Explore how attitudes toward scientists and scientific information shifted between 2018 and 2020.

### Card 1

% globally who trust scientists

```{r}
df_wgm2018 %>%
  filter(!is.na(Q11C)) %>%
  summarise(
    trust_percent = 100 * sum(wgt[Q11C %in% c(1, 2)]) / sum(wgt)
  )
```

```{r}
df_wgm2020 %>%
  filter(!is.na(W5C)) %>%
  summarise(
    trust_percent = 100 * sum(WGT[W5C %in% c(1, 2)]) / sum(WGT)
  )
```

### Card 2
% who trust in national government advice

```{r}
df_wgm2018 %>%
  filter(!is.na(Q11B)) %>%
  summarise(
    trust_percent = 100 * sum(wgt[Q11B %in% c(1, 2)]) / sum(wgt)
  )
```

```{r}
df_wgm2020 %>%
  filter(!is.na(W5B)) %>%
  summarise(
    trust_percent = 100 * sum(WGT[W5B %in% c(1, 2)]) / sum(WGT)
  )
```

## Global Trust in Scientists Plots {.tabset}

### 2018

```{r}
trust2018 <- df_wgm2018 %>%
  filter(!is.na(Q11C)) %>%
  mutate(
    is_1_or_2 = if_else(Q11C %in% c(1, 2), 1, 0),
    weighted_is_1_or_2 = wgt * is_1_or_2
  ) %>%
  group_by(country_name, region) %>%
  summarise(
    percent = 100 * sum(weighted_is_1_or_2, na.rm = TRUE) / sum(wgt, na.rm = TRUE)
  )
```

```{r}
ggplot(trust2018, aes(x = percent, y = country_name, color = region)) +
  geom_point() +
  labs(
    title = "Percent of Trust for each Country",
    x = "% of Responses (Weighted)",
    y = "Country",
    color = "Region"
  ) +
  theme_minimal() +
  theme(
    axis.text.y = element_blank()
  )
```

### 2020

```{r}
trust2020 <- df_wgm2020 %>%
  filter(!is.na(W5C)) %>%
  mutate(
    is_1_or_2 = if_else(W5C %in% c(1, 2), 1, 0),
    weighted_is_1_or_2 = WGT * is_1_or_2
  ) %>%
  group_by(COUNTRYNEW, region) %>%
  summarise(
    percent = 100 * sum(weighted_is_1_or_2, na.rm = TRUE) / sum(WGT, na.rm = TRUE)
  )
```

```{r}
ggplot(trust2020, aes(x = percent, y = COUNTRYNEW, color = region)) +
  geom_point() +
  labs(
    title = "Percent of Trust for each Country",
    x = "% of Responses (Weighted)",
    y = "Country",
    color = "Region"
  ) +
  theme_minimal() +
  theme(
    axis.text.y = element_blank()
  )
```

# Does Science Benefit your People

## Vaccine Confidence Intro
How did belief in science benefiting your country change before and during the COVID-19 pandemic?

### 2018 vs 2020

```{r}
#ggplot: bar chart or line comparing global % across years

2+1
```

### Regional Breakdown

```{r}
## grouped bar plot: vaccine trust by region

3*3
```

## Global Map

```{r}
# Leaflet map: shade countries by % who agree vaccines are safe

5+5
```



